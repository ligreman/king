<h2 mat-dialog-title fxLayout="row" fxLayoutAlign="space-between start" class="margin-bottom-5-i">
    <span *ngIf="!editMode">{{'upstream.dialog.create' | translate}}</span>
    <span *ngIf="editMode">{{'upstream.dialog.edit' | translate}}</span>
    <span><a mat-button href="https://docs.konghq.com/2.2.x/admin-api/#add-upstream" target="_blank">
    {{'text.documentation' | translate}}
        <mat-icon class="mini-icon">open_in_new</mat-icon></a></span>
</h2>

<mat-divider class="margin-bottom-20-i"></mat-divider>

<mat-dialog-content class="mat-typography" fxLayout="row" fxLayoutAlign="center start">
    <div fxFlex="90">
        <p fxFlex="100" fxLayout="row" fxLayoutAlign="center center" *ngIf="servicesAvailable.length === 0">
            {{ 'upstream.dialog.no_upstream' | translate}}
        </p>

        <form [formGroup]="form" *ngIf="servicesAvailable.length > 0">
            <!--Nombre-->
            <div fxLayout="column" class="margin-bottom-10">
                <div fxLayout="row" fxLayoutAlign="space-between start" class="margin-bottom-10">
                    <mat-form-field fxFlex="50" color="accent" appearance="outline">
                        <mat-label>{{'upstream.dialog.name' | translate}}</mat-label>
                        <mat-select formControlName="name" cdkFocusInitial>
                            <mat-option *ngFor="let srvs of servicesAvailable" value="{{srvs}}">{{srvs}}</mat-option>
                        </mat-select>
                        <mat-error *ngIf="nameField.invalid">
                            {{ 'error.field_required' | translate }}
                        </mat-error>
                        <mat-hint>{{'upstream.dialog.name_hint' | translate}}</mat-hint>
                    </mat-form-field>


                    <mat-form-field fxFlex="45" color="accent" appearance="outline">
                        <mat-chip-list #chipList aria-label="">
                            <mat-chip *ngFor="let tag of currentTags"
                                      removable="true" (removed)="removeTag(tag)">{{tag}}
                                <mat-icon matChipRemove>cancel</mat-icon>
                            </mat-chip>
                            <input placeholder="{{'service.dialog.tags' | translate}}"
                                   formControlName="tags"
                                   [matChipInputFor]="chipList"
                                   [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                   matChipInputAddOnBlur="true"
                                   (matChipInputTokenEnd)="addTag($event)">
                        </mat-chip-list>
                        <mat-hint>{{'service.dialog.tags_hint' | translate}}</mat-hint>
                    </mat-form-field>
                </div>


                <!---->
                <div fxLayout="row" fxLayoutAlign="space-between start" class="margin-bottom-10">
                    <mat-form-field fxFlex="30" color="accent" appearance="outline">
                        <mat-label>{{'upstream.dialog.algorithm' | translate}}</mat-label>
                        <mat-select formControlName="algorithm">
                            <mat-option *ngFor="let algos of validAlgorithms" value="{{algos}}">{{algos}}</mat-option>
                        </mat-select>
                        <mat-error *ngIf="algorithmField.invalid">
                            {{ 'error.field_required' | translate }}
                        </mat-error>
                        <mat-hint>
                            <a class="link" target="_blank" href="https://docs.konghq.com/2.2.x/loadbalancing/">
                                {{'upstream.dialog.algorithm_hint' | translate}}
                                <mat-icon class="link">open_in_new</mat-icon>
                            </a>
                        </mat-hint>
                    </mat-form-field>
                    <mat-form-field fxFlex="30" color="accent" appearance="outline">
                        <mat-label>{{'upstream.dialog.hash_on' | translate}}</mat-label>
                        <mat-select formControlName="hash_on">
                            <mat-option *ngFor="let hashon of validHash" value="{{hashon}}">{{hashon}}</mat-option>
                        </mat-select>
                        <mat-icon matSuffix matTooltip="{{'upstream.dialog.hash_on_tooltip' | translate}}"
                                  matTooltipClass="tooltip-teal">info_outline
                        </mat-icon>
                        <mat-error *ngIf="hashOnField.invalid">
                            {{ 'error.field_required' | translate }}
                        </mat-error>
                    </mat-form-field>
                    <mat-form-field fxFlex="30" color="accent" appearance="outline">
                        <mat-label>{{'upstream.dialog.hash_fallback' | translate}}</mat-label>
                        <mat-select formControlName="hash_fallback">
                            <mat-option *ngFor="let hashfall of validHash" value="{{hashfall}}">{{hashfall}}</mat-option>
                        </mat-select>
                        <mat-icon matSuffix matTooltip="{{'upstream.dialog.hash_fallback_tooltip' | translate}}"
                                  matTooltipClass="tooltip-teal">info_outline
                        </mat-icon>
                        <mat-error *ngIf="hashFallbackField.invalid">
                            {{ 'error.field_required' | translate }}
                        </mat-error>
                    </mat-form-field>
                </div>
            </div>

            <mat-accordion multi displayMode="flat" hideToggle>
                <mat-expansion-panel #matExp disabled>
                    <mat-expansion-panel-header class="margin-bottom-20-i">
                        <mat-panel-description fxLayout="row" fxLayoutAlign="center start">
                            <button mat-flat-button (click)="matExp.toggle(); $event.stopPropagation();" fxFlex="50" color="primary">
                                <mat-icon [fxShow]="matExp._getExpandedState()==='collapsed'">expand_more</mat-icon>
                                <mat-icon [fxShow]="matExp._getExpandedState()==='expanded'">expand_less</mat-icon>
                                {{'text.advanced_fields' | translate}}
                                <mat-icon [fxShow]="matExp._getExpandedState()==='collapsed'">expand_more</mat-icon>
                                <mat-icon [fxShow]="matExp._getExpandedState()==='expanded'">expand_less</mat-icon>
                            </button>
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <!--
                                        <div fxLayout="row" fxLayoutAlign="space-between start">
                                            &lt;!&ndash;Reintentos&ndash;&gt;
                                            <mat-form-field fxFlex="23" color="accent" appearance="outline" class="margin-bottom-10">
                                                <mat-label>{{'service.dialog.retries' | translate}}</mat-label>
                                                <input type="number" aria-label="" matInput formControlName="retries"/>
                                                <mat-error *ngIf="retriesField.invalid">
                                                    {{ 'service.dialog.error.retries_min_max' | translate }}
                                                </mat-error>
                                            </mat-form-field>

                                            &lt;!&ndash;Timeout conexión&ndash;&gt;
                                            <mat-form-field fxFlex="23" color="accent" appearance="outline">
                                                <mat-label>{{'service.dialog.connect_timeout' | translate}}</mat-label>
                                                <input type="number" aria-label="" matInput formControlName="connect_timeout"/>
                                                <mat-icon matSuffix matTooltip="{{'service.dialog.connect_tooltip' | translate}}"
                                                          matTooltipClass="tooltip-teal">info_outline
                                                </mat-icon>
                                                <mat-error *ngIf="connectTimeoutField.invalid">
                                                    {{ 'service.dialog.error.timeout_min_max' | translate }}
                                                </mat-error>
                                            </mat-form-field>

                                            &lt;!&ndash;Timeout escritura&ndash;&gt;
                                            <mat-form-field fxFlex="23" color="accent" appearance="outline">
                                                <mat-label>{{'service.dialog.write_timeout' | translate}}</mat-label>
                                                <input type="number" aria-label="" matInput formControlName="write_timeout"/>
                                                <mat-icon matSuffix matTooltip="{{'service.dialog.write_tooltip' | translate}}"
                                                          matTooltipClass="tooltip-teal">info_outline
                                                </mat-icon>
                                                <mat-error *ngIf="writeTimeoutField.invalid">
                                                    {{ 'service.dialog.error.timeout_min_max' | translate }}
                                                </mat-error>
                                            </mat-form-field>

                                            &lt;!&ndash;Timeout lectura&ndash;&gt;
                                            <mat-form-field fxFlex="23" color="accent" appearance="outline">
                                                <mat-label>{{'service.dialog.read_timeout' | translate}}</mat-label>
                                                <input type="number" aria-label="" matInput formControlName="read_timeout"/>
                                                <mat-icon matSuffix matTooltip="{{'service.dialog.read_tooltip' | translate}}"
                                                          matTooltipClass="tooltip-teal">info_outline
                                                </mat-icon>
                                                <mat-error *ngIf="readTimeoutField.invalid">
                                                    {{ 'service.dialog.error.timeout_min_max' | translate }}
                                                </mat-error>
                                            </mat-form-field>
                                        </div>

                                        <div fxLayout="row" fxLayoutAlign="space-between start">
                                            &lt;!&ndash;Certificado cliente&ndash;&gt;
                                            <mat-form-field fxFlex="50" color="accent" class="margin-bottom-10" appearance="outline">
                                                <mat-label>{{'service.dialog.certificate' | translate}}</mat-label>
                                                <mat-select formControlName="client_certificate" [disabled]="certificatesAvailable.length === 0">
                                                    <mat-option value="{{cert}}" *ngFor="let cert of certificatesAvailable">{{cert}}</mat-option>
                                                </mat-select>
                                                <mat-icon matSuffix matTooltip="{{'service.dialog.certificate_tooltip' | translate}}"
                                                          matTooltipClass="tooltip-teal">info_outline
                                                </mat-icon>
                                            </mat-form-field>

                                            &lt;!&ndash;TLS&ndash;&gt;
                                            <mat-form-field fxFlex="20" color="accent" class="margin-bottom-10" appearance="outline">
                                                <mat-label>{{'service.dialog.tls_verify' | translate}}</mat-label>
                                                <mat-select formControlName="tls_verify">
                                                    <mat-option value=""></mat-option>
                                                    <mat-option value="true">true</mat-option>
                                                    <mat-option value="false">false</mat-option>
                                                </mat-select>
                                                <mat-icon matSuffix matTooltip="{{'service.dialog.tls_verify_tooltip' | translate}}"
                                                          matTooltipClass="tooltip-teal">info_outline
                                                </mat-icon>
                                            </mat-form-field>

                                            &lt;!&ndash;TLS Depth&ndash;&gt;
                                            <mat-form-field fxFlex="25" color="accent" class="margin-bottom-10" appearance="outline">
                                                <mat-label>{{'service.dialog.tls_verify_depth' | translate}}</mat-label>
                                                <input type="number" aria-label="" matInput formControlName="tls_verify_depth"/>
                                                <mat-icon matSuffix matTooltip="{{'service.dialog.tls_verify_depth_tooltip' | translate}}"
                                                          matTooltipClass="tooltip-teal">info_outline
                                                </mat-icon>
                                                <mat-error *ngIf="tlsVerifyDepthField.invalid">
                                                    {{ 'service.dialog.error.tls_depth_min_max' | translate }}
                                                </mat-error>
                                            </mat-form-field>
                                        </div>

                                        <div fxLayout="row" fxLayoutAlign="space-between start">
                                            &lt;!&ndash;CA Certificates&ndash;&gt;
                                            <mat-form-field fxFlex="50" color="accent" class="margin-bottom-10" appearance="outline">
                                                <mat-label>{{'service.dialog.ca_certificates' | translate}}</mat-label>
                                                <textarea aria-label="" matInput formControlName="ca_certificates"
                                                          placeholder="{{'service.dialog.ca_certificates_example' | translate}}"></textarea>
                                                <mat-icon matSuffix matTooltip="{{'service.dialog.ca_certificates_tooltip' | translate}}"
                                                          matTooltipClass="tooltip-teal">info_outline
                                                </mat-icon>
                                                <mat-error *ngIf="caCertificatesField.invalid">
                                                    {{ 'service.dialog.error.ca_certificate_pattern' | translate }}
                                                </mat-error>
                                            </mat-form-field>
                                        </div>
                                        -->
                </mat-expansion-panel>
            </mat-accordion>
        </form>
    </div>
</mat-dialog-content>

<mat-divider class="margin-bottom-10-i margin-top-10-i"></mat-divider>

<mat-dialog-actions fxLayout="row" fxLayoutAlign="space-between start">
    <div>
        <mat-error *ngIf="form.hasError('finalForm')">
            {{ 'service.dialog.error.protocol_path_collision' | translate }}
        </mat-error>
    </div>

    <div>
        <button mat-button mat-dialog-close="null" color="warn">{{'text.cancel' | translate}}</button>
        <!-- Si a disabled le pasamos una función da error de ExpressionChangedAfterItHasBeenCheckedError -->
        <button mat-flat-button [mat-dialog-close]="onSubmit()" color="accent"
                [disabled]="form.invalid">
            <span *ngIf="!editMode">{{'text.create' | translate}}</span>
            <span *ngIf="editMode">{{'text.edit' | translate}}</span>
        </button>
    </div>
</mat-dialog-actions>

